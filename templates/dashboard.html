{% extends "base.html" %}

{% block content %}
<h2>Dashboard</h2>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h3>Welcome, {{ user.username }}!</h3>
        <p>Total Readers: {{ user.total_reader }} | Upvotes: {{ user.total_upvotes }} | Downvotes: {{ user.total_downvotes }}</p>
    </div>
    <a href="/create" style="background: #007acc; color: white; padding: 0.8rem 1.5rem; text-decoration: none; border-radius: 0.3rem;">New Post</a>
</div>

{% if posts %}
    {% for post in posts %}
    <article style="margin-bottom: 2rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
                <h3><a href="/post/{{ post.slug }}">{{ post.title }}</a></h3>
                <div class="post-meta">
                    <span>{{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                    <span>•</span>
                    <span>{{ post.views }} views</span>
                    <span>•</span>
                    <span>{{ post.upvotes }} upvotes</span>
                    {% if post.private %}
                    <span>•</span>
                    <span style="color: #d32f2f;">Private</span>
                    {% endif %}
                </div>
                {% if post.tags %}
                <div class="tags">
                    {% for tag in post.tags %}
                        <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="dashboard-actions">
                <a href="/edit/{{ post.post_id }}" style="background: #28a745; color: white; padding: 0.3rem 0.8rem; text-decoration: none; border-radius: 0.3rem; font-size: 0.85em;">Edit</a>
                <button onclick="confirmDelete('{{ post.post_id }}')" style="background: #dc3545; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 0.3rem; font-size: 0.85em; cursor: pointer;">Delete</button>
            </div>
        </div>
    </article>
    {% endfor %}
    
    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="pagination">
        {% if current_page > 1 %}
            <a href="/dashboard?page={{ current_page - 1 }}">&laquo; Previous</a>
        {% endif %}
        
        {% for page_num in range(1, total_pages + 1) %}
            {% if page_num == current_page %}
                <span class="current">{{ page_num }}</span>
            {% else %}
                <a href="/dashboard?page={{ page_num }}">{{ page_num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if current_page < total_pages %}
            <a href="/dashboard?page={{ current_page + 1 }}">Next &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <p>You haven't created any posts yet. <a href="/create">Create your first post!</a></p>
{% endif %}
{% endblock %}